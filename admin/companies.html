  <!doctype html>
  <html lang="en">
  <head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Companies Management</title>
  <!-- CSS Links -->
  <link rel="stylesheet" href="../assets/css/bootstrap.min.css" />
  <link rel="stylesheet" href="../assets/css/all.min.css" />
  <link rel="stylesheet" href="../assets/css/styles.css" />
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css"/>

  <!-- Internal Style For Modals -->
  <style>
  /* ===== ADD COMPANY MODAL ===== */
  .add-company-modal{
    border-radius: 16px;
    background: #F8F9FC;
  }

  .modal-title{
    font-weight: 800;
    color:#1F2937;
  }

  .modal-subtitle{
    font-size:14px;
    color:#64748b;
    margin:0;
  }

  .modal-back{
    cursor:pointer;
    font-size:18px;
    color:#475569;
  }

  .form-section-card{
    background:#fff;
    border-radius:14px;
    padding:20px;
    margin-bottom:18px;
    border:0.8px solid #e5e7eb;
  }

  .section-title{
    font-weight:700;
    font-size:15px;
    color:#1F2937;
    display:flex;
    align-items:center;
    gap:8px;
    margin-bottom:16px;
  }
  .section-title i{
    color:#2563EB;
  }

  .form-label {
    font-size:14px;
    font-weight: 400;
    color:#1F2937;
  }
  .custom-input{
    border-radius:10px;
    height:44px;
  }

  .input-group-custom{
    position:relative;
  }

  .input-group-custom i{
    position:absolute;
    left:12px;
    top:50%;
    transform:translateY(-50%);
    color:#64748b;
    font-size:14px;
  }

  .input-group-custom input{
    padding-left:38px;
  }

  .alert-info-soft{
    background:#EFF6FF;
    border:0.8px solid #BEDBFF;
    color:#1C398E;
    border-radius:10px;
    padding:12px 14px;
    display:flex;
    align-items:center;
    gap:10px;
    font-size:13px;
  }

  .custom-footer{
    border-top: 0.8px solid #E5E7EB;
    padding:16px 24px;
    display:flex;
    justify-content:flex-end;
    gap:12px;
  }

  /* ================= VIEW DETAILS MODAL ================= */
  .view-details-modal{
    border-radius: 16px;
    padding-bottom: 10px;
  }

  .view-details-modal .modal-title{
    font-size: 28px;
    color: #0f172a;
  }

  /* Stat Cards */
  .stat-card{
    display: flex;
    flex-direction: column;
    justify-content: start;
    align-items: start;
    padding: 16px;
    border-radius: 16px;
    height: 100%;
  }

  .stat-card .icon{
    font-size: 20px;
  }

  .stat-card .text span{
    font-size: 20px;
    font-weight: 400;
    color: #475569;
  }

  .stat-card .text h2{
    margin: 0;
    font-size: 38px;
    font-weight: 800;
    color: #0f172a;
  }

  /* Cards Colors */
  .stat-card.blue{background:#EFF6FF;}
  .stat-card.blue .icon{color:#155DFC;}

  .stat-card.green{background:#F0FDF4;}
  .stat-card.green .icon{color:#00A63E;}

  .stat-card.yellow{background:#FEFCE8;}
  .stat-card.yellow .icon{color:#D08700;}

  .stat-card.purple{background:#FAF5FF;}
  .stat-card.purple .icon{color:#9810FA;}

  /* Performance Box */
  .performance-box{
    display: flex;
    flex-direction: column;
  }

  .performance-box h5{
    font-size:16px;
    color:#6A7282;
    font-weight: 400;
    margin-bottom:20px;
  }
  .metric-container {
    background:#F9FAFB;
    border-radius:10px;
    padding:16px;
  }

  .metric-row{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:12px 0;
    font-size:18px;
    color:#4A5565;
  }

  .status-active{color:#00A63E;font-weight:700;}
  .status-inactive{color:#6b7280;font-weight:700;}
  </style>
  </head>

  <body>
    <!-- Sidebar Toggle Overlay (Mobile) -->
  <div class="sidebar-overlay" id="sidebarOverlay"></div>

  <!-- ===== Sidebar (Desktop) ===== -->
    <aside class="sidebar d-flex flex-column" id="sidebar">
      <!-- 1. Header Section -->
      <div class="sidebar-header">
        <!-- Logo Text -->
        <div class="logo">
          <h4>LockAccess Pro</h4>
          <p>Platform Admin</p>
        </div>

        <!-- Close button (Mobile) -->
        <button class="btn d-md-none text-muted" id="closeSidebar">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <!-- 2. Navigation Menu -->
      <ul class="menu flex-grow-1">
        <li data-page="dashboard" class="active">
          <a href="dashboard.html">
            <i class="fa-solid fa-table-cells-large"></i>
            Dashboard
          </a>
        </li>

        <li data-page="companies">
          <a href="companies.html">
            <i class="fa-regular fa-building"></i>
            Companies
          </a>
        </li>

        <li data-page="reports">
          <a href="reports.html">
            <i class="fa-regular fa-file-lines"></i>
            Reports
          </a>
        </li>

        <li data-page="jobs">
          <a href="jobs.html">
            <i class="fa-solid fa-user-group"></i>
            Jobs
          </a>
        </li>

        <li data-page="notifications">
          <a href="notifications.html">
            <i class="fa-regular fa-bell"></i>
            Notifications
          </a>
        </li>

        <li data-page="customers">
          <a href="customers.html">
            <i class="fa-solid fa-user-group"></i>
            Customer
          </a>
        </li>

        <li data-page="users">
          <a href="users.html">
            <i class="fa-solid fa-user-group"></i>
            Users
          </a>
        </li>

          <li data-page="calls">
          <a href="calls.html">
          <i class="fa-solid fa-mobile-screen"></i> Call Logs
          </a>
        </li>
      </ul>
      <!-- 3. Sidebar Footer (User Profile) -->
      <div class="sidebar-footer">
        <div class="d-flex align-items-center gap-3">
          <!-- Avatar Circle -->
          <div class="user-avatar" id="userAvatar">U</div>

          <!-- Text Info -->
          <div class="user-info">
            <h6 id="sidebarUsername">User</h6>
            <small id="sidebarEmail">user@email.com</small>
          </div>
        </div>
      </div>
    </aside>

  <!-- ===== Main Wrapper ===== -->
  <div class="main-wrapper" id="mainWrapper">
    
    <!-- 1. Mobile Header (Visible only on mobile/tablet) -->
    <div class="d-lg-none p-3 bg-white border-bottom d-flex align-items-center justify-content-between sticky-top">
      <h5 class="m-0 fw-bold text-dark">LockAccess Pro</h5>
      <button class="btn btn-light" id="toggleSidebar">
        <i class="fas fa-bars"></i>
      </button>
    </div>

    <!-- 2. Main Content Area -->
    <main class="mb-4">
      
      <!-- Page Header (Desktop View title) -->
      <div class="d-flex flex-column justify-content-left mb-4">
        <h3 class="page-title">Companies Management</h3>
        <p class="page-subtitle">Manage and monitor all locksmith companies on the platform.</p>
      </div>

      <!-- Main Data Content -->
      <div class="row content g-3 align-items-center">
        <!-- Search -->
        <div class="col-lg-10">
          <div class="search-box">
            <i class="fas fa-search"></i>
            <input type="text" id="customSearch" placeholder="Search companies..." />
          </div>
        </div>

        <!-- Add Company Button -->
        <div class="col-lg-2">
          <button class="btn add-btn w-100" data-bs-toggle="modal" data-bs-target="#addCompanyModal">
            <i class="fas fa-plus me-2"></i> Add Company
          </button>
        </div>

        <!-- Table -->
        <div class="table-responsive mt-3">
          <table id="companiesTable" class="table w-100">
            <thead>
              <tr>
                <th>Company</th>
                <th>Status</th>
                <th>Dispatchers</th>
                <th>Technicians</th>
                <th>Active Jobs</th>
                <th>Completed</th>
                <th>Revenue</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      
    </main>
  </div>

    <!-- ================= ADD COMPANY MODAL ================= -->
    <div class="modal fade" id="addCompanyModal" tabindex="-2">
    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content add-company-modal">
        <!-- Header -->
        <div class="modal-header border-0 pb-2">
          <div class="d-flex align-items-center gap-3">
            <i class="fas fa-arrow-left modal-back" data-bs-dismiss="modal"></i>
            <div>
              <h4 class="modal-title">Add New Company</h4>
              <p class="modal-subtitle">Register a new locksmith company on the platform</p>
            </div>
          </div>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <!-- Body -->
        <div class="modal-body px-4">
          <!-- Info -->
          <div class="form-section-card">
            <h6 class="section-title"><i class="fa-solid fa-building"></i> Company Information</h6>
            <div class="row g-3">
              <div class="col-12">
                <label class="form-label required">Company Name</label>
                <input type="text" id="companyName" class="form-control custom-input" placeholder="e.g., ABC Locksmith Services">
              </div>
              <div class="error-text" id="err-companyName"></div>

              <div class="col-md-6">
                <label class="form-label required">Business Email</label>
                <div class="input-group-custom">
                  <i class="fa-regular fa-envelope"></i>
                  <input type="email" id="companyEmail" class="form-control" placeholder="contact@company.com">
                </div>
                <div class="error-text" id="err-companyEmail"></div>
              </div>

              <div class="col-md-6">
                <label class="form-label required">Business Phone</label>
                <div class="input-group-custom">
                  <i class="fa-solid fa-phone"></i>
                  <input type="text" id="companyPhone" class="form-control" placeholder="(555) 123-4567">
                </div>
                <div class="error-text" id="err-companyPhone"></div>
              </div>

              <div class="col-md-6">
                <label class="form-label">Business License Number</label>
                <input type="text" id="licenseNumber" class="form-control custom-input" placeholder="Enter business license number">
              </div>

              <div class="col-md-6">
                <label class="form-label required">Commission</label>
                <input type="text" id="commission" class="form-control custom-input">
                <div class="error-text" id="err-commission"></div>
              </div>

              <div class="col-md-6">
                <label class="form-label">Tax ID / EIN</label>
                <input type="text" id="taxId" class="form-control custom-input" placeholder="XX-XXXXXXX">
              </div>

              <div class="col-md-6">
                <label class="form-label required">Company Status</label>
                <select id="companyStatus" class="form-select custom-input">
                  <option value="" disabled selected></option>
                  <option value="Active">Active</option>
                  <option value="Pending">Pending</option>
                  <option value="Suspended">Suspended</option>
                </select>
                <div class="error-text" id="err-companyStatus"></div>
              </div>
            </div>
          </div>

          <!-- Address -->
          <div class="form-section-card">
            <h6 class="section-title"><i class="fa-solid fa-location-dot"></i> Business Address</h6>
            <div class="row g-3">
              <div class="col-12">
                <label class="form-label required">Street Address</label>
                <input type="text" id="street" class="form-control custom-input" placeholder="123 Main Street">
              </div>
              <div class="error-text" id="err-street"></div>

              <div class="col-md-6">
                <label class="form-label required">City</label>
                <input type="text" id="city" class="form-control custom-input" placeholder="New York">
              </div>
              <div class="error-text" id="err-city"></div>

              <div class="col-md-6">
                <label class="form-label required">State</label>
                <input type="text" id="state" class="form-control custom-input">
              </div>
              <div class="error-text" id="err-state"></div>

              <div class="col-md-6">
                <label class="form-label required">ZIP Code</label>
                <input type="text" id="zip" class="form-control custom-input" placeholder="10001">
              </div>
              <div class="error-text" id="err-zip"></div>

              <div class="col-md-6">
                <label class="form-label required">Area</label>
                <input type="text" id="area" class="form-control custom-input">
              </div>
              <div class="error-text" id="err-area"></div>
            </div>
          </div>

          <!-- Admin -->
          <div class="form-section-card">
            <h6 class="section-title"><i class="fa-regular fa-user"></i> Company Administrator</h6>
            <div class="alert alert-info-soft">
              <i class="fa-solid fa-circle-info"></i>
              <span>This person will be the primary admin for this company.</span>
            </div>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label required">Admin Full Name</label>
                <input type="text" id="adminName" class="form-control custom-input" placeholder="John Smith">
              </div>
              <div class="error-text" id="err-adminName"></div>

              <div class="col-md-6">
                <label class="form-label required">Admin Email</label>
                <div class="input-group-custom">
                  <i class="fa-regular fa-envelope"></i>
                  <input type="email" id="adminEmail" class="form-control" placeholder="admin@company.com">
                </div>
                <div class="error-text" id="err-adminEmail"></div>
              </div>

              <div class="col-md-6">
                <label class="form-label required">Admin Phone</label>
                <div class="input-group-custom">
                  <i class="fa-solid fa-phone"></i>
                  <input type="text" id="adminPhone" class="form-control" placeholder="(555) 123-4567">
                </div>
                <div class="error-text" id="err-adminPhone"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Footer -->
        <div class="modal-footer custom-footer">
          <button class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-primary" id="saveCompany">
            <i class="fa-solid fa-building me-2"></i> Create Company
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ================= VIEW DETAILS MODAL ================= -->
  <div class="modal fade" id="viewDetailsModal" tabindex="-2">
    <div class="modal-dialog modal-xl modal-dialog-centered">
      <div class="modal-content view-details-modal">
        <div class="modal-header border-0 pb-0">
          <h3 class="modal-title fw-bold" id="modalCompanyName">Company</h3>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <hr class="mx-4">
        <div class="modal-body px-4">
          <div class="row g-4 mb-4">
            <div class="col-md-6">
              <div class="stat-card blue gap-4">
                <div class="d-flex align-items-center gap-3">
                  <div class="icon"><i class="fa-solid fa-users"></i></div>
                  <div class="text"><span>Dispatchers</span></div>
                </div>
                <h2 id="d_dispatchers">0</h2>
              </div>
            </div>
            <div class="col-md-6">
              <div class="stat-card green gap-4">
                <div class="d-flex align-items-center gap-3">
                  <div class="icon"><i class="fa-solid fa-users"></i></div>
                  <div class="text"><span>Technicians</span></div>
                </div>
                <h2 id="d_technicians">0</h2>
              </div>
            </div>
            <div class="col-md-6">
              <div class="stat-card yellow gap-4">
                <div class="d-flex align-items-center gap-3">
                  <div class="icon"><i class="fa-solid fa-briefcase"></i></div>
                  <div class="text"><span>Active Jobs</span></div>
                </div>
                <h2 id="d_active">0</h2>
              </div>
            </div>
            <div class="col-md-6">
              <div class="stat-card purple gap-4">
                <div class="d-flex align-items-center gap-3">
                  <div class="icon"><i class="fa-solid fa-chart-line"></i></div>
                  <div class="text"><span>Total Revenue</span></div>
                </div>
                <h2 id="d_revenue">0</h2>
              </div>
            </div>
          </div>
          
          <!-- Performance Metrics Box -->
          <div class="performance-box">
            <h5>Performance Metrics</h5>
            <div class="metric-container">
              <div class="metric-row">
                <span>Completed Jobs</span>
                <strong id="d_completed">0</strong>
              </div>
              <div class="metric-row">
                <span>Status</span>
                <strong id="d_status" class="status-active">Active</strong>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- JS -->
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
  <script src="../assets/js/bootstrap.bundle.min.js"></script>
  <script src="../assets/js/script.js"></script>

<script>
//// Company Table Logic ////

let companiesTable;

const MOCK_COMPANIES = [
  {name:"QuickLock Services",status:"Active",dispatchers:3,technicians:8,activeJobs:12,completed:487,revenue:125400},
  {name:"SecureAccess Inc",status:"Active",dispatchers:2,technicians:5,activeJobs:7,completed:312,revenue:89200},
  {name:"MasterKey Solutions",status:"Active",dispatchers:4,technicians:12,activeJobs:15,completed:623,revenue:178900},
  {name:"City Lock & Key",status:"Active",dispatchers:2,technicians:6,activeJobs:9,completed:401,revenue:98500},
  {name:"Emergency Locksmith Co",status:"Inactive",dispatchers:1,technicians:3,activeJobs:0,completed:156,revenue:42300},
  {name:"Emergency Locksmith Co",status:"Inactive",dispatchers:1,technicians:3,activeJobs:0,completed:156,revenue:42300},
  {name:"Emergency Locksmith Co",status:"Inactive",dispatchers:1,technicians:3,activeJobs:0,completed:156,revenue:42300},
  {name:"Emergency Locksmith Co",status:"Inactive",dispatchers:1,technicians:3,activeJobs:0,completed:156,revenue:42300}
];

$(document).ready(function(){

  companiesTable = initDataTable(
    "#companiesTable", MOCK_COMPANIES, [
      { data: "name" },
      { 
        data: "status",
        render: (d) => window.renderStatusBadge(d),
      },
      { data: "dispatchers" },
      { data: "technicians" },
      { data: "activeJobs" },
      { data: "completed" },
      { 
        data: "revenue",
        render: d => `$${d.toLocaleString()}`
      },
      { 
        data: null,
        render: () => `<a href="#" class="view-details text-decoration-none text-primary fw-semibold">View Details</a>`
      }
    ]
  );

  /* Search */
  $("#customSearch").on("keyup",function(){
    companiesTable.search(this.value).draw();
  });

  /* View Details Modal*/
  $('#companiesTable').on('click','.view-details',function(){
    const data = companiesTable.row($(this).parents('tr')).data();

    $("#modalCompanyName").text(data.name);
    $("#d_dispatchers").text(data.dispatchers);
    $("#d_technicians").text(data.technicians);
    $("#d_active").text(data.activeJobs);
    $("#d_completed").text(data.completed);
    $("#d_revenue").text(data.revenue.toLocaleString());
    $("#d_status").text(data.status);

    if(data.status==="Active"){
      $("#d_status").removeClass("status-inactive").addClass("status-active");
    }else{
      $("#d_status").removeClass("status-active").addClass("status-inactive");
    }

    new bootstrap.Modal(document.getElementById('viewDetailsModal')).show();
  });

  /* Add Company Modal*/
/* ===== Add Company Validation ===== */
$("#saveCompany").on("click", function () {

  let isValid = true;

  const requiredFields = [
    { id: "companyName", msg: "Company name is required" },
    { id: "companyEmail", msg: "Business email is required", type: "email" },
    { id: "companyPhone", msg: "Business phone is required" },
    { id: "commission", msg: "Commission is required" },
    { id: "companyStatus", msg: "Company status is required" },

    { id: "street", msg: "Street address is required" },
    { id: "city", msg: "City is required" },
    { id: "state", msg: "State is required" },
    { id: "zip", msg: "ZIP code is required" },
    { id: "area", msg: "Area is required" },

    { id: "adminName", msg: "Admin name is required" },
    { id: "adminEmail", msg: "Admin email is required", type: "email" },
    { id: "adminPhone", msg: "Admin phone is required" }
  ];

 // Reset form and errors when modal is closed
  $('#addCompanyModal').on('hidden.bs.modal', function () {
  // Clear all input values 
  $(this).find('input, select').val('');

  // Remove error classes
  $(this).find('.form-control, .form-select').removeClass('input-error');

  // Hide error messages
  $(this).find('.error-text').hide();
  });

  requiredFields.forEach(field => {
    const el = $("#" + field.id);
    const val = el.val()?.trim();

    if (!val) {
      isValid = false;
      el.addClass("input-error");
      $("#err-" + field.id).text(field.msg).show();
    }

    /* Email validation */
    if (field.type === "email" && val) {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(val)) {
        isValid = false;
        el.addClass("input-error");
        $("#err-" + field.id).text("Invalid email format").show();
      }
    }
  });

  if (!isValid) return;

  /* If valid â†’ add company */
  const newCompany = {
    name: $("#companyName").val(),
    status: $("#companyStatus").val(),
    dispatchers: 0,
    technicians: 0,
    activeJobs: 0,
    completed: 0,
    revenue: 0
  };

  companiesTable.row.add(newCompany).draw(false);

  bootstrap.Modal.getInstance(
    document.getElementById('addCompanyModal')
  ).hide();
  });
  
  /* Auto clear error on input */
  $(document).on("input change", ".form-control, .form-select", function(){
  $(this).removeClass("input-error");
  $("#err-" + this.id).hide();
  });

  });
  </script>

  </body>
  </html>